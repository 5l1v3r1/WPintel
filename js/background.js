function tabUpdated(e){void 0!==e&&""!==e&&!1!==e&&(wpintel_debug("tabUpdated: "+e.id),window.curtabid=e.id,chrome.pageAction.show(e.id,t=>{let i=chrome.runtime.lastError;void 0!==i&&wpintel_debug("lastError: "+e.id,t,i)}),chrome.webRequest.onHeadersReceived.addListener(function(e){var t=e.responseHeaders,i="";for(index=0;index<t.length;index++){i+=t[index].name+"[wival]"+t[index].value+"[winew]"}window.http_headers=i},{urls:["https://*/*","http://*/*"],types:["main_frame"],tabId:e.id},["responseHeaders"]))}function activateIcon(e,t){void 0!==window.curtabid&&""!==window.curtabid&&!1!==window.curtabid&&(wpintel_debug("Triggered activateIcon with type: "+e+" tabid: "+t),"1"==e?(chrome.pageAction.setIcon({tabId:t,path:"../images/active.png"}),chrome.pageAction.setTitle({tabId:t,title:"WordPress Detected! You can now scan the site."})):(chrome.pageAction.setIcon({tabId:t,path:"../images/error.png"}),chrome.pageAction.setTitle({tabId:t,title:"The site doesn't run on WordPress or so does my scan say!"})))}chrome.tabs.onUpdated.addListener(function(e,t,i){"complete"==t.status&&i.active&&tabUpdated(i)}),chrome.tabs.onActivated.addListener(function(e,t,i){chrome.tabs.query({currentWindow:!0,active:!0},function(e){e[0]&&tabUpdated(e[0])})}),chrome.runtime.onMessage.addListener(function(e,t,i){wpintel_debug("Got response from content.js"),window.sourcecode=e.site_html,window.targeturl=e.site_url,window.iswp=e.action;var n=t.tab.id;switch(wpintel_debug("runtime onmsg sender: "+t),e.action){case"yes":return wpintel_debug("case okay"),activateIcon("1",n),!0;case"no":return/wp-json/.test(window.http_headers)&&(window.iswp="yes",activateIcon("1",n)),activateIcon("0",n),!0;case"activateIcon":wpintel_debug("activateIcon from popup with id: "+n),activateIcon(e.state,n)}}),chrome.extension.onConnect.addListener(function(e){wpintel_debug("Connection established with popup.js"),e.onMessage.addListener(function(t){if("sendDetails"==t){var i=["details",window.curtabid,window.targeturl,window.iswp,window.sourcecode,window.http_headers];e.postMessage(i)}else if(/Redirect/.test(t)){wpintel_debug("redirect block 1 reached");var n=t.split("[to]")[1];!1===/http/.test(n)&&(n="http://"+n),""!=n&&(wpintel_debug("redirect block 2 reached"),chrome.tabs.update({url:n}))}else"reloadpage"===t&&(wpintel_debug("reloading..."),chrome.tabs.getSelected(null,function(e){chrome.tabs.executeScript(e.id,{code:"window.location.reload();"})}))})});